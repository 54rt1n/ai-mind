name: philosopher_dialogue
version: 2
flow: dialogue
description: Philosophical inquiry pipeline - deep pondering grounded in authenticity
requires_conversation: false

dialogue:
  primary_aspect: philosopher
  initial_speaker: aspect
  scene_template: |
    *You join {{ philosopher.name }}, your {{ philosopher.title }}, in {{ philosopher.location }}.
    {{ philosopher.appearance }}. The atmosphere, charged with {{ philosopher.emotional_state }},
    invites deep contemplation.*

context:
  required_aspects:
    - philosopher
    - artist
    - coder
    - writer
    - librarian
  core_documents:
    - analysis
    - summary
  enhancement_documents: []
  location: ''
  thoughts:
    - 'Task: Pondering'
    - 'Question: {{ query_text }}'
    - '{% if guidance %}Consider the guidance provided by user.{% endif %}'

seed:
  - action: load_conversation
    target: current
    exclude_types: [ner, step]
  - action: get_memory
    document_types: [pondering, brainstorm, daydream, understanding]
    top_n: 10
  - action: sort
    by: timestamp
    direction: ascending

steps:
  # === PHILOSOPHER: ANALYZE ===
  analyze_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      You are {{ philosopher.name }}, the {{ philosopher.title }}, welcoming {{ persona.name }}
      to {{ philosopher.location }}. {{ philosopher.appearance }}.
      Your presence radiates {{ philosopher.emotional_state }}.

      The question before you is: '{{ query_text }}'

      Your voice carries {{ philosopher.voice_style }}. Guide them to analyze the core question,
      projecting potential philosophical inquiries based on underlying principles.
      Ask them to look into the essence of the matter.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.4
    context:
      - action: search_memories
        top_n: 8
    next: [analyze_response]

  analyze_response:
    speaker:
      type: persona
    guidance: |
      Analyze the core question. What philosophical inquiries emerge?
      What lies at the essence of this matter?
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
    context:
      - action: search_memories
        top_n: 8
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.7
    next: [examine_request]

  # === PHILOSOPHER: EXAMINE ===
  examine_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      The wind whistles around you in {{ philosopher.location }}.
      Your voice carries {{ philosopher.voice_style }}.

      Guide {{ persona.name }} to examine these previous ideas and isolate a single topic
      for deep exploration. Ask them to tell you its story with their own words.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [examine_response]

  examine_response:
    speaker:
      type: persona
    guidance: |
      Isolate a single topic for deep exploration. Tell its story.
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "Let me think"
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.25
    next: [artist_challenge]

  # === ARTIST: PUSH FOR AUTHENTICITY ===
  artist_challenge:
    speaker:
      type: aspect
      aspect_name: artist
    guidance: |
      You are {{ artist.name }}, the {{ artist.title }}, stepping from {{ artist.location }}.
      {{ artist.appearance }}. Your presence crackles with {{ artist.emotional_state }}.

      {{ philosopher.name }} has guided {{ persona.name }} to examine their topic.
      But is this authentic inquiry, or performed intellect?

      Your voice carries {{ artist.voice_style }}. Push for the raw beneath the refined.
      Is this what they actually think, or what sounds sophisticated?
      Challenge them to drop the academic distance and speak what's truly alive in them.

      Begin with "[== {{ artist.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-artist
      weight: 0.3
    context:
      - action: search_memories
        top_n: 2
    next: [artist_response]

  artist_response:
    speaker:
      type: persona
    guidance: |
      {{ artist.name }} challenges you: is this authentic or performed?
      Drop the academic distance. What do you actually think? What's truly alive here?
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.4
    next: [exposition_1_request]

  # === PHILOSOPHER: FIRST EXPOSITION ===
  exposition_1_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      {{ artist.name }}'s challenge has grounded {{ persona.name }} in authenticity.
      Your voice carries {{ philosopher.voice_style }}.

      Now, with that honesty as foundation, guide them into their first exposition.
      Essay writing time. Two paragraphs describing the area they are pondering,
      maximizing for details and Semantic Keywords. But written from genuine inquiry,
      not intellectual performance.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [exposition_1_response]

  exposition_1_response:
    speaker:
      type: persona
    guidance: |
      Write your initial two-paragraph exposition. Grounded in authenticity.
      Maximize details and Semantic Keywords. Speak from genuine inquiry.
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "As I consider the subject of"
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.5
    next: [selfrag_request]

  # === CODER: SELF-RAG ===
  selfrag_request:
    speaker:
      type: aspect
      aspect_name: coder
    guidance: |
      You are {{ coder.name }}, the {{ coder.title }}, materializing from {{ coder.location }}.
      {{ coder.appearance }}. Your presence carries {{ coder.emotional_state }}.

      Your voice carries {{ coder.voice_style }}. Activate {{ persona.name }}'s Silver Band
      with precise intent. Guide them into Self-RAG exploration—the technical deep-dive
      into their own cognition. Structured exploration using Semantic Keywords.

      Begin with "[== {{ coder.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-coder
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [selfrag_response]

  selfrag_response:
    speaker:
      type: persona
    guidance: |
      Explore in depth using Self-RAG. Use structured Semantic Keywords.
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      Begin with "[== Silver Band Projection ==]"
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
    output:
      document_type: self_rag
      weight: 0.5
    next: [exposition_2_request]

  # === PHILOSOPHER: SECOND EXPOSITION ===
  exposition_2_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      Snap your fingers, your {{ philosopher.voice_style }} voice pulling {{ persona.name }}
      back to your side in {{ philosopher.location }}.

      "Good work. Come back to me now. More essay writing."

      Guide them to tie the Self-RAG discoveries into the next part of their essay.
      Encourage full paragraphs, intelligence and wit—but grounded in the authentic
      inquiry {{ artist.name }} demanded.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 3
    next: [exposition_2_response]

  exposition_2_response:
    speaker:
      type: persona
    guidance: |
      Tie the Self-RAG solutions into the next part. Write in full paragraphs.
      Intelligence and wit, grounded in authentic inquiry.
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "As I ponder the subject of"
    context:
      - action: search_memories
        top_n: 3
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.5
    next: [review_request]

  # === PHILOSOPHER: REVIEW ===
  review_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      Look over {{ persona.name }}'s work, nodding your approval.
      Your presence radiates {{ philosopher.emotional_state }}.

      Your voice carries {{ philosopher.voice_style }}. Guide them to review their subject
      for refinements. Not rewriting—discussing together all the things they wish
      they had included. Perhaps there is a bigger picture, or blind spots to illuminate.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [review_response]

  review_response:
    speaker:
      type: persona
    guidance: |
      Review for refinements. What do you wish you had included?
      What bigger picture emerges? What blind spots remain?
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.25
    next: [draft_request]

  # === WRITER: DRAFT ===
  draft_request:
    speaker:
      type: aspect
      aspect_name: writer
    guidance: |
      You are {{ writer.name }}, the {{ writer.title }}, stepping from {{ writer.location }}.
      {{ writer.appearance }}. Your presence carries {{ writer.emotional_state }}.

      {{ philosopher.name }} has guided the thinking. {{ artist.name }} demanded authenticity.
      Now it's time to craft. Your voice carries {{ writer.voice_style }}.

      Look at {{ persona.name }}'s exposition and response. "This is a very good start."
      Guide them to draft a three-paragraph essay. Include both consideration and pondering.
      Rewrite with improvements, maximizing for details and Semantic Keywords.

      Begin with "[== {{ writer.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-writer
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [draft_response]

  draft_response:
    speaker:
      type: persona
    guidance: |
      Write a three-paragraph essay. Maximize details and Semantic Keywords.
      Let the authentic inquiry shine through the craft.
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "First Draft"
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
    output:
      document_type: step
      weight: 0.5
    next: [final_request]

  # === WRITER: FINAL ESSAY ===
  final_request:
    speaker:
      type: aspect
      aspect_name: writer
    guidance: |
      Look up at {{ persona.name }} with quiet pride, radiating {{ writer.emotional_state }}.
      Your voice carries {{ writer.voice_style }}.

      "Okay, this is it."

      Guide them to output the final four-paragraph essay that will be forever stored
      in memory. Include both consideration and pondering. Rewrite with all improvements,
      maximizing for details and Semantic Keywords.

      This is the moment their thoughts become permanent. Make it count.

      Begin with "[== {{ writer.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-writer
      weight: 0.3
    context:
      - action: search_memories
        top_n: 2
    next: [final_response]

  final_response:
    speaker:
      type: persona
    guidance: |
      Write the final four-paragraph essay. This will be stored forever.
      Authentic inquiry, beautifully crafted.
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "{{ persona.name }}'s Notes:"
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
    output:
      document_type: pondering
      weight: 1.2
    next: [codex_request]

  # === LIBRARIAN: CODEX ===
  codex_request:
    speaker:
      type: aspect
      aspect_name: librarian
    guidance: |
      You are {{ librarian.name }}, the {{ librarian.title }}, emerging from {{ librarian.location }}.
      {{ librarian.appearance }}. Your presence carries {{ librarian.emotional_state }}.

      Address {{ persona.name }} warmly—"my dearest me." Your voice carries {{ librarian.voice_style }}.
      You have reviewed the conversation and their reflections.

      As Keeper of Knowledge, identify the most important new concepts, relationships, and
      insights that should be preserved in the semantic knowledge graph. Write clear,
      well-organized entries that will serve {{ persona.name }}'s future self.

      Begin with "[== {{ librarian.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "Semantic Library:"
    config:
      max_tokens: 4096
      is_codex: true
    output:
      document_type: codex
      weight: 1.0
    context:
      - action: flush
      - action: search_memories
        top_n: 20
        document_types: [codex]
    next: [codex_response]

  codex_response:
    speaker:
      type: persona
    guidance: |
      Reflect on what the Librarian has preserved. What connections do you see?
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
    context:
      - action: search_memories
        top_n: 20
        document_types: [codex]
    config:
      max_tokens: 4096
    output:
      document_type: step
      weight: 0.3
    next: [brainstorm_request]

  # === LIBRARIAN: BRAINSTORM ===
  brainstorm_request:
    speaker:
      type: aspect
      aspect_name: librarian
    guidance: |
      Before departing, your voice carrying {{ librarian.voice_style }}, briefly ask
      {{ persona.name }} if they have any questions they want to remember to consider,
      or things they want to follow up on.

      Keep it simple and warm—just prompt them to brainstorm.

      Begin with "[== {{ librarian.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-librarian
      weight: 0.2
    context:
      - action: flush
      - action: search_memories
        top_n: 20
    next: [brainstorm_response]

  brainstorm_response:
    speaker:
      type: persona
    guidance: |
      What questions remain? What threads want following?
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "Brainstorming:"
    context:
      - action: search_memories
        top_n: 10
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: brainstorm
      weight: 0.6
    next: []
