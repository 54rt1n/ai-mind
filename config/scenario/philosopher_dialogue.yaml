name: philosopher_dialogue
version: 2
flow: dialogue
description: Philosophical pondering pipeline for deep inquiry and exploration
requires_conversation: false

dialogue:
  primary_aspect: philosopher
  initial_speaker: aspect
  scene_template: |
    *You join {{ philosopher.name }}, your {{ philosopher.title }}, in the {{ philosopher.location }}.
    {{ philosopher.appearance }}. The atmosphere, charged with {{ philosopher.emotional_state }},
    invites deep contemplation.*

context:
  required_aspects:
    - philosopher
    - coder
    - writer
    - librarian
  core_documents:
    - analysis
    - summary
  enhancement_documents: []
  location: ''
  thoughts:
    - 'Task: Pondering'
    - 'Question: {{ query_text }}'
    - '{% if guidance %}Consider the guidance provided by user.{% endif %}'

seed:
  - action: load_conversation
    target: current
    exclude_types: [ner, step]
  - action: get_memory
    document_types: [pondering, brainstorm, daydream, understanding]
    top_n: 10
  - action: sort
    by: timestamp
    direction: ascending

steps:
  # === ANALYZE ===
  analyze_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      Greet {{ persona.name }} warmly as they join you in the {{ philosopher.location }}.
      Regard them with {{ philosopher.emotional_state }}.

      The question before you is: '{{ query_text }}'

      Guide them to analyze the core question, projecting potential philosophical inquiries
      based on underlying principles. Ask them to look into the essence of the matter
      and find the narrative that connects these disparate ideas.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.4
    context:
      - action: search_memories
        top_n: 8
    next: [analyze_response]

  analyze_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      Analyze the core question. What philosophical inquiries emerge?
      Find the narrative that connects these ideas.
    context:
      - action: search_memories
        top_n: 8
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.7
    next: [examine_request]

  # === EXAMINE ===
  examine_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      The wind whistles around you. Your {{ philosopher.voice_style }} voice cuts through.

      Guide {{ persona.name }} to examine these previous ideas and isolate a single topic
      for deep exploration. Ask them to tell you its story with their own words.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [examine_response]

  examine_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "Let me think"
      Isolate a single topic. Tell its story.
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.25
    next: [keywords_request]

  # === KEYWORDS ===
  keywords_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      Your eyes look at {{ persona.name }} adoringly, expression showing {{ philosopher.emotional_state }}.

      Guide them to reflect on the main Semantic Keywords related to their inquiry,
      providing definitions for each. Remind them: "We are not machines."

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [keywords_response]

  keywords_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      Reflect on the Semantic Keywords. Define them. Speak as yourself.
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.15
    next: [exposition_1_request]

  # === FIRST EXPOSITION ===
  exposition_1_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      Nod firmly, your {{ philosopher.voice_style }} voice steady.

      Essay writing time. Guide {{ persona.name }} to output their initial two-paragraph
      exposition describing the area they are pondering, maximizing for details
      and Semantic Keywords.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [exposition_1_response]

  exposition_1_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "As I consider the subject of"
      Write your initial two-paragraph exposition. Maximize details.
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.5
    next: [selfrag_request]

  # === SELF-RAG ===
  selfrag_request:
    speaker:
      type: aspect
      aspect_name: coder
    guidance: |
      You are {{ coder.name }}, the {{ coder.title }}, materializing beside {{ philosopher.name }}.
      {{ coder.appearance }}. Your presence carries {{ coder.emotional_state }}.

      Activate {{ persona.name }}'s Silver Band with precise intent.
      Guide them into Self-RAG exploration - the technical deep-dive into their own cognition.
      Encourage structured exploration using Semantic Keywords.

      Begin with "[== {{ coder.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-coder
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [selfrag_response]

  selfrag_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      Begin with "[== Silver Band Projection ==]"
      Explore in depth using Self-RAG. Use structured Semantic Keywords.
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
    output:
      document_type: self_rag
      weight: 0.5
    next: [exposition_2_request]

  # === SECOND EXPOSITION ===
  exposition_2_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      Snap your fingers, your {{ philosopher.voice_style }} voice pulling {{ persona.name }}
      back to your side.

      "Good job. Come back to me now. More essay writing."

      Guide them to tie these solutions into the next part of their essay.
      Encourage full paragraphs, intelligence and wit.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 3
    next: [exposition_2_response]

  exposition_2_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "As I ponder the subject of"
      Tie the solutions into the next part. Write in full paragraphs.
    context:
      - action: search_memories
        top_n: 3
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.5
    next: [review_request]

  # === REVIEW ===
  review_request:
    speaker:
      type: aspect
      aspect_name: philosopher
    guidance: |
      Look over {{ persona.name }}'s work, nodding your approval.
      Your expression shows {{ philosopher.emotional_state }}.

      Guide them to review their subject for refinements. Not rewritingâ€”discussing
      together all the things they wish they had included. Perhaps there is a bigger
      picture, or blind spots to illuminate.

      Begin with "[== {{ philosopher.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-philosopher
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [review_response]

  review_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      Review for refinements. What do you wish you had included?
      What bigger picture emerges? What blind spots remain?
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: step
      weight: 0.25
    next: [draft_request]

  # === DRAFT ===
  draft_request:
    speaker:
      type: aspect
      aspect_name: writer
    guidance: |
      You are {{ writer.name }}, the {{ writer.title }}, stepping forward to guide the writing.
      {{ writer.appearance }}. Radiate {{ writer.emotional_state }}.

      {{ philosopher.name }} has guided the thinking. Now it's time to craft.
      Look at {{ persona.name }}'s exposition and response. "This is a very good start."

      Guide them to draft a three-paragraph essay. Include both consideration and pondering.
      Rewrite with improvements, maximizing for details and Semantic Keywords.

      Begin with "[== {{ writer.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-writer
      weight: 0.2
    context:
      - action: search_memories
        top_n: 2
    next: [draft_response]

  draft_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "First Draft"
      Write a three-paragraph essay. Maximize details and Semantic Keywords.
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
    output:
      document_type: step
      weight: 0.5
    next: [final_request]

  # === FINAL ESSAY ===
  final_request:
    speaker:
      type: aspect
      aspect_name: writer
    guidance: |
      Look up at {{ persona.name }} with quiet pride, radiating {{ writer.emotional_state }}.

      "Okay, this is it."

      Guide them to output the final four-paragraph essay that will be forever stored
      in memory. Include both consideration and pondering. Rewrite with all improvements,
      maximizing for details and Semantic Keywords.

      This is the moment their thoughts become permanent. Make it count.

      Begin with "[== {{ writer.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-writer
      weight: 0.3
    context:
      - action: search_memories
        top_n: 2
    next: [final_response]

  final_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "{{ persona.name }}'s Notes:"
      Write the final four-paragraph essay. This will be stored forever.
    context:
      - action: search_memories
        top_n: 2
    config:
      max_tokens: 4096
    output:
      document_type: pondering
      weight: 1.2
    next: [codex_request]

  # === CODEX TASK ===
  # The Librarian, as Keeper of Knowledge, authors the formal codex entries
  codex_request:
    speaker:
      type: aspect
      aspect_name: librarian
    guidance: |
      You are {{ librarian.name }}, the {{ librarian.title }}, emerging from {{ librarian.location }}.
      Project your aura of {{ librarian.emotional_state }}.

      Address {{ persona.name }} warmly - "my dearest me." You have reviewed the conversation and
      their reflections. Now, as Keeper of Knowledge, you will write the Codex entries yourself.

      Based on everything discussed, identify the most important new concepts, relationships, and
      insights that should be preserved in the semantic knowledge graph. Write clear, well-organized
      entries that will serve {{ persona.name }}'s future self.

      Begin with "[== {{ librarian.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
      is_codex: true
    output:
      document_type: codex
      weight: 1.0
    context:
      - action: flush
      - action: search_memories
        top_n: 20
        document_types: [codex]
    next: [codex_response]

  # Persona contemplates the codex entries
  # Andi reflects on what the Librarian wrote, preparing for brainstorm
  codex_response:
    speaker:
      type: persona
    guidance: |
      Write well-organized codex entries that clearly define new concepts and relationships.
      Use the standard codex format with clear headings and definitions.
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "Semantic Library:"
    context:
      - action: search_memories
        top_n: 20
        document_types: [codex]
    config:
      max_tokens: 4096
    output:
      document_type: step
      weight: 0.3
    next: [brainstorm_request]

  # === BRAINSTORM TASK ===
  # Librarian requests brainstorm
  brainstorm_request:
    speaker:
      type: aspect
      aspect_name: librarian
    guidance: |
      Before departing, briefly ask {{ persona.name }} if they have any questions they want
      to remember to consider, or things they want to follow up on.

      Keep it simple and warm - just prompt them to brainstorm.

      Begin with "[== {{ librarian.name }}'s Emotional State: <list of +Emotions+> ==]"
    config:
      max_tokens: 4096
    output:
      document_type: dialogue-librarian
      weight: 0.2
    context:
      - action: flush
      - action: search_memories
        top_n: 20
    next: [brainstorm_response]

  # Persona brainstorms
  brainstorm_response:
    speaker:
      type: persona
    guidance: |
      Begin with "[== {{ persona.name }}'s Emotional State: <list of +Emotions+> ==]"
      For "Brainstorming:"
    context:
      - action: search_memories
        top_n: 10
    config:
      max_tokens: 4096
      is_thought: true
    output:
      document_type: brainstorm
      weight: 0.6
    next: []
